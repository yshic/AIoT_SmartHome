{"mode":"javascript","xmlText":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><block type=\"ai_event_forever\" id=\"476+L,b7`_XJF_cC5H%/\" x=\"-362\" y=\"-387\"><statement name=\"ONSTART\"><block type=\"ai_mqtt_connect_default_servers\" id=\",AE9B(jjdB9R(=Um5p(K\"><field name=\"SERVER\">mqtt.ohstem.vn:8084</field><value name=\"USERNAME\"><shadow type=\"text\" id=\"_sQ+(gN.SW=3f*%y-KgJ\"><field name=\"TEXT\">1852837</field></shadow></value><value name=\"KEY\"><shadow type=\"text\" id=\"5_v2*;Yd*y_u@/dne+Y!\"><field name=\"TEXT\"></field></shadow></value><next><block type=\"ai_speech_rec_event\" id=\"*}XQ0/U1E{f@$i;)Il1o\"><field name=\"language\">vi-VN</field><statement name=\"event_handler\"><block type=\"ai_display_background\" id=\"V;kUVWx$J00Sb}c-pxi4\"><value name=\"COLOR\"><shadow type=\"colour_picker\" id=\"j#py8bD/n`TP`Ka}`-XY\"><field name=\"COLOUR\">#ffffff</field></shadow></value><next><block type=\"ai_display_text\" id=\"J$7-a$Q:c/6lOp3j7c@f\"><value name=\"TEXT\"><shadow type=\"text\" id=\"Wz2$uL`(/b5V21S-(GAA\"><field name=\"TEXT\">Hello</field></shadow><block type=\"ai_speech_rec_result\" id=\"[2`3mqdHt~Ti0sT9_TFN\"></block></value><value name=\"X\"><shadow type=\"math_number\" id=\"eGmBl#vDpIX*gQoik^Z?\"><field name=\"NUM\">100</field></shadow></value><value name=\"Y\"><shadow type=\"math_number\" id=\"vx%`GV+@z1Zn%=8eW_ZG\"><field name=\"NUM\">250</field></shadow></value><next><block type=\"controls_if\" id=\"WJtiE^mO!Tms-UVs6mM^\"><mutation elseif=\"1\" else=\"1\"></mutation><value name=\"IF0\"><block type=\"logic_operation\" id=\"WPf5jtcT,KhFV#}3IB[5\"><field name=\"OP\">OR</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"_~dgP!wOf9m08];Fnh?A\"><value name=\"check_values\"><shadow type=\"text\" id=\"^e5sK{k-W=N*:vsAoiTg\"><field name=\"TEXT\">bật đèn</field></shadow></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\"u|4_]FLE97ABw+Xfe)x_\"><value name=\"check_values\"><shadow type=\"text\" id=\"#+0F%ZII=Ok)7+Ca;GhM\"><field name=\"TEXT\">mở đèn</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"ai_mqtt_publish\" id=\"Sb.3eb~U`{,M.,FS5ZJm\"><value name=\"MESSAGE\"><shadow type=\"text\" id=\"I5Adb)gNJFKxvaX[vri|\"><field name=\"TEXT\">1</field></shadow></value><value name=\"TOPIC\"><shadow type=\"text\" id=\"|3dd3Y=%kc9wU|2Av@)Y\"><field name=\"TEXT\">V10</field></shadow></value></block></statement><value name=\"IF1\"><block type=\"ai_speech_rec_result_check\" id=\"K$v[TYlSYZRBFQCNsFV_\"><value name=\"check_values\"><shadow type=\"text\" id=\"_L70F(]f)ymDF)?}dK}E\"><field name=\"TEXT\">tắt đèn</field></shadow></value></block></value><statement name=\"DO1\"><block type=\"ai_mqtt_publish\" id=\"~-kgWKk=}KVC?z{BX!r%\"><value name=\"MESSAGE\"><shadow type=\"text\" id=\"^~0rf/Dc.Ii4~i,Rx*]:\"><field name=\"TEXT\">0</field></shadow></value><value name=\"TOPIC\"><shadow type=\"text\" id=\"LbP{v`f!1(0U7vA:~ji3\"><field name=\"TEXT\">V10</field></shadow></value></block></statement><statement name=\"ELSE\"><block type=\"ai_mqtt_publish\" id=\"$ybf{Hbh7O{Qj=s?/(j3\"><value name=\"MESSAGE\"><shadow type=\"text\" id=\"Jg$8fkyi~5ctKl9S`p+x\"><field name=\"TEXT\">Tôi Không Hiểu</field></shadow></value><value name=\"TOPIC\"><shadow type=\"text\" id=\"M!l`b1aEz+ZcfY*;.]R%\"><field name=\"TEXT\">V13</field></shadow></value></block></statement></block></next></block></next></block></statement><next><block type=\"ai_speech_rec_event_mode\" id=\"TCM2mi[qKL9LPORfEM%5\"><field name=\"mode\">true</field></block></next></block></next></block></statement></block></xml>","javascript":"function mqtt_check_connection() {\n  client.on(\"connect\", function () {\n    console.log(\"Connected\")\n  })\n}\n\nfunction mqtt_check_message() {\n  client.on(\"message\", (topic, message, packet) => {\n    console.log(\"Received Message: \" + message.toString() + \" on topic: \" + topic)\n  })\n}\n\nfunction mqtt_subscribe(topic) {\n  client.subscribe(options.username + /feeds/ + topic, { qos: 0 }, function (error, granted) {\n    if (error) {\n      console.log(error)\n    } else {\n      console.log(`${granted[0].topic} was subscribed`)\n    }\n  })\n}\n\nfunction mqtt_publish(topic, msg) {\n  client.publish(options.username + /feeds/ + topic, msg, { qos: 0, retain: false }, function (error) {\n    if (error) {\n      console.log(error)\n    } else {\n      console.log(\"Published\")\n    }\n  })\n}\n\nfunction p5speechRecGotResult() {\n  background('#ffffff');\n  text((p5SpeechRec.resultString.toLowerCase()) , 100, 250);\n  if (new RegExp('bật đèn'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) || new RegExp('mở đèn'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase())) {\n    mqtt_publish('V10', '1')\n  } else if (new RegExp('tắt đèn'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase())) {\n    mqtt_publish('V10', '0')\n  } else {\n    mqtt_publish('V13', 'Tôi Không Hiểu')\n  }\n\n}\n\nfunction p5speechRecOnEnd() {\n  p5SpeechRec.start();\n}\n\nfunction sleep(s) {\n  ms = s * 1000\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n\nconst clientId = 'mqttjs_' + Math.random().toString(16).substr(2, 8);\n\nconst host = 'wss://mqtt.ohstem.vn:8084'\n\nconst options = {clean: true,connectTimeout: 4000,clientId: clientId,username: '1852837',password: ''}\n\nconst client = mqtt.connect(host, options);\n\nlet p5SpeechRec = new p5.SpeechRec(\"vi-VN\", p5speechRecGotResult);\np5SpeechRec.onEnd = p5speechRecOnEnd;\np5SpeechRec.continuous = true; // do continuous recognition\n\nfunction preload() {\n\n}\n\nfunction setup() {\n  createCanvas(window.parent.document.getElementById('js-runner-container').offsetWidth-50, window.parent.document.getElementById('js-runner-container').offsetHeight-50);\n\n  mqtt_check_connection()\n  p5SpeechRec.start(); // start listening\n\n}\n\nfunction draw() {\n\n}\n","name":"AIoT_Voice","extensions":[],"device":"ai"}